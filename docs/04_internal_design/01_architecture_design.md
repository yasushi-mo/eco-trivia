# エコ・トリビア アプリ アーキテクチャ設計書

## 1. 全体概要

エコ・トリビアアプリは、ユーザーインターフェース、ビジネスロジック、データアクセスを明確に分離した**3 層アーキテクチャ**を採用します。開発には、モノレポ構成の**npm workspaces**と、TypeScript を全面的に使用します。

- **フロントエンド**: React
- **バックエンド**: Express.js (TypeScript)
- **データベース**: PostgreSQL
- **ホスティング**: Render

---

## 2. 各層のコンポーネントと役割

### プレゼンテーション層 (Frontend)

ユーザーが直接操作する部分です。

- **役割**: UI の表示、ユーザーからの入力受付、バックエンド API へのリクエスト送信。
- **技術**: React (TypeScript)
- **ホスティング先**: Render (Static Site)
- **主要コンポーネント**:
  - **QuizScreen**: 日替わりクイズを表示し、ユーザーの回答を処理します。
  - **TriviaScreen**: 回答後に表示され、トリビアの解説を見せます。

### ビジネスロジック層 (Backend)

アプリのコアとなる処理を担います。

- **役割**: クイズデータの取得、クイズの正誤判定、データベースへのアクセス管理。
- **技術**: Express.js (TypeScript)
- **ホスティング先**: Render (Web Service)
- **主要コンポーネント**:
  - **QuizController**: `/api/quiz`のようなエンドポイントを定義し、フロントエンドからのリクエストを処理します。
  - **QuizService**: クイズを取得するロジックや、複雑なビジネスルールを実行します。

### データアクセス層 (Database)

データの永続化と管理を担当します。

- **役割**: PostgreSQL へのデータの読み書き。
- **技術**: PostgreSQL
- **ホスティング先**: Render (PostgreSQL)
- **主要コンポーネント**:
  - **QuizRepository**: データベースからクイズデータを取得・更新するメソッドを実装します。SQL クエリを直接扱う部分です。
  - **TriviaRepository**: トリビアデータを扱うメソッドを実装します。

---

## 3. データの流れ（API 設計の概要）

**フロントエンド**は、バックエンドの API を通じてデータにアクセスします。

1.  **QuizScreen**がロードされると、バックエンドの`/api/quiz/today`のようなエンドポイントにリクエストを送信します。
2.  **QuizController**がリクエストを受け取り、**QuizService**を呼び出します。
3.  **QuizService**は**QuizRepository**を通じて、データベースから今日のクイズデータを取得します。
4.  取得したデータは JSON 形式でフロントエンドに返され、**QuizScreen**に表示されます。
5.  ユーザーが回答を送信すると、その回答がバックエンドに送られ、正誤判定が行われます。
